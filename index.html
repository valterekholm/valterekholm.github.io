<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>Mini Asteroids – komplexa tal</title>
<style>
  body { margin: 0; background: black; overflow: hidden; }
  canvas { display: block; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>

if(window.screen.height > window.screen.width && window.location.hostname.includes("github")){
	let answ = confirm("Switch to mobile friendly screen?");
	if(answ){
		window.location.assign("https://valterekholm.github.io/index_251225.html");
	}
}
	
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// ===== KOMPLEXA TAL =====
const C = (re, im) => ({ re, im });

const add = (a, b) => C(a.re + b.re, a.im + b.im);

const mul = (a, b) => C(
  a.re * b.re - a.im * b.im,
  a.re * b.im + a.im * b.re
);

const scale = (z, s) => C(z.re * s, z.im * s);

const rot = angle => C(Math.cos(angle), Math.sin(angle));

// ===== SPELVARIABLER =====
let ship = {
  pos: C(canvas.width / 2, canvas.height / 2),
  vel: C(0, 0),
  dir: C(1, 0)
};

let bullets = [];
let asteroids = [];

for (let i = 0; i < 6; i++) {
  asteroids.push({
    pos: C(Math.random() * canvas.width, Math.random() * canvas.height),
    vel: C(Math.random() - 0.5, Math.random() - 0.5),
    r: 30
  });
}

let keys = {};

// ===== INPUT =====
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

// ===== SKÄRM-WRAP =====
function wrap(obj) {
  obj.pos.re = (obj.pos.re + canvas.width) % canvas.width;
  obj.pos.im = (obj.pos.im + canvas.height) % canvas.height;
}

let gameOver = false;
// ===== GAME LOOP =====
function update() {
  if(gameOver) return;
  
  // Rotation
  if (keys["ArrowLeft"]) ship.dir = mul(ship.dir, rot(-0.08));
  if (keys["ArrowRight"]) ship.dir = mul(ship.dir, rot(0.08));

  // Acceleration
  if (keys["ArrowUp"]) {
    ship.vel = add(ship.vel, scale(ship.dir, 0.15));
  }

  // Skott
  if (keys[" "]) {
    if (!keys._fireLock) {
      bullets.push({
        pos: C(ship.pos.re, ship.pos.im),
        vel: scale(ship.dir, 8),
        life: 60
      });
      keys._fireLock = true;
    }
  } else {
    keys._fireLock = false;
  }

  // Uppdatera skepp
  ship.pos = add(ship.pos, ship.vel);
  ship.vel = scale(ship.vel, 0.99); // friktion
  wrap(ship);

  // Uppdatera skott
  bullets = bullets.filter(b => b.life-- > 0);
  bullets.forEach(b => {
    b.pos = add(b.pos, b.vel);
    wrap(b);
  });

  let newAsteroids = [];
  // Uppdatera asteroider
  asteroids.forEach(a => {
    a.pos = add(a.pos, a.vel);
    wrap(a);
	
	bullets.forEach(b => {
		if(dist(a.pos, b.pos) < a.r){
			b.life = 0 // ta bort skott
			
			newAsteroids.push(...splitAsteroid(a));
			
			a.dead = true;
		}
	})
  });
  
  //Filtrera bort träffade asteroider
  asteroids = asteroids.filter(a => !a.dead);
  
  //Lägg till nya
  asteroids.push(...newAsteroids);
  
  //kollision
  asteroids.forEach(a => {
	if(dist(ship.pos, a.pos) < a.r + 10){
		//alert("BOOM");
		setTimeout(function(){
			location.reload();
		}, 800);
		gameOver = true;
	}
   });

  draw();
  if(!gameOver)
	requestAnimationFrame(update);
}

// ===== RITA =====
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Skepp
  ctx.save();
  ctx.translate(ship.pos.re, ship.pos.im);
  ctx.rotate(Math.atan2(ship.dir.im, ship.dir.re));
  ctx.beginPath();
  ctx.moveTo(15, 0);
  ctx.lineTo(-10, -8);
  ctx.lineTo(-6, 0);
  ctx.lineTo(-10, 8);
  ctx.closePath();
  ctx.strokeStyle = "white";
  ctx.stroke();
  ctx.restore();

  // Skott
  bullets.forEach(b => {
    ctx.fillStyle = "white";
    ctx.fillRect(b.pos.re - 2, b.pos.im - 2, 4, 4);
  }); 

  // Asteroider
  asteroids.forEach(a => {
    ctx.beginPath();
    ctx.arc(a.pos.re, a.pos.im, a.r, 0, Math.PI * 2);
	ctx.strokeStyle = "white";
    ctx.stroke();
  });
}

function dist(a, b){
	const dx = a.re - b.re;
	const dy = a.im - b.im;
	return Math.sqrt(dx*dx + dy*dy);
}

function hit(a, b, radius){
	return dist(a.pos, b.pos) < radius;
}

function splitAsteroid(a) {
	if(a.r < 15) return [];
	
	const angle = Math.random() * Math.PI * 2;
	
	return [
		{
			pos: C(a.pos.re, a.pos.im),
			vel: add(a.vel, mul(rot(angle), C(1,0))),
			r: a.r / 2
		},
		{
			pos: C(a.pos.re, a.pos.im),
			vel: add(a.vel, mul(rot(angle + Math.PI), C(1,0))),
			r: a.r / 2
		}
	];
}

update();
</script>
<!-- Code made with partly with usage of chatGPT, 20251225, after the leading question "Hur kan imaginära tal användas?", 3.V.E -->
</body>
</html>
